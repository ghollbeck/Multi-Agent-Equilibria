flowchart TD
    A[Main Script] -->|Imports and Constants| B[DEFAULT_PAYOFFS & RESULTS_SCHEMA]
    A --> C[Load Environment Variables]
    A --> D[Config Class]
    A --> E[Strategy Class Hierarchy]
    E --> E1[Strategy]
    E --> E2[RandomStrategy]
    E --> E3[TitForTatStrategy]
    E --> E4[GrimTriggerStrategy]
    E --> E5[PavlovStrategy]
    E --> E6[GenerousTitForTatStrategy]
    A --> F[Player Class]
    A --> G[GameEngine Class]
    G -->|Static Methods| G1[misperceive(action, prob)]
    G -->|Static Methods| G2[compute_payoff(self_act, perceived_other, payoffs)]
    G -->|Methods| G3[play()]
    A --> H[SimulationRunner Class]
    H -->|Methods| H1[run()]
    H -->|Methods| H2[save(df)]
    H -->|Methods| H3[_get_strategy()]
    H -->|Methods| H4[_plot_cooperation_rate(df, outdir)]
    H -->|Methods| H5[_plot_payoff_histograms(df, outdir)]
    H -->|Methods| H6[_plot_confidence_intervals(df, outdir)]
    A --> I[LiteLLMClient Class]
    I -->|Methods| I1[_call_litellm(messages, model, temperature)]
    A --> J[setup_main_logger(log_path)]
    A --> K[main()]
    K -->|Argument Parsing| K1[CLI Argument Parsing]
    K -->|Config Setup| K2[Load and Override Config]
    K -->|Directory Setup| K3[Setup Run Directories]
    K -->|Logger Setup| K4[Setup Loggers]
    K -->|Batch Mode| K5[Run SimulationRunner]
    A --> L[Inline Unittest Suite]
    L --> L1[TestGameEngine]
    L --> L2[TestSimulationRunner]
    L --> L3[TestJSONSchema]